<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>User-Managed Access (UMA) Core Protocol</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="User-Managed Access (UMA) Core Protocol">
<meta name="generator" content="xml2rfc v1.36 (http://xml.resource.org/)">
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: small; color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: small; font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: small; font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: small; text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">T. Hardjono, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">MIT</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">December 17, 2012</td></tr>
<tr><td class="header">Expires: June 20, 2013</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />User-Managed Access (UMA) Core Protocol<br />draft-hardjono-oauth-umacore-06B</h1>

<h3>Abstract</h3>

<p>User-Managed Access (UMA) is a profile of OAuth 2.0. UMA defines how resource owners can control access to their protected resources made by clients operated by arbitrary rquesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policy.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on June 20, 2013.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2012 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#introduction">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">1.1.</a>&nbsp;
Notational Conventions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#terminology">1.2.</a>&nbsp;
Basic Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#endpoint-discussion">1.3.</a>&nbsp;
Endpoints, Endpoint Protection, and Tokens<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#scope-discussion">1.4.</a>&nbsp;
Scope Types, Resource Sets, Permissions, and Authorization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#am-endpoints">1.5.</a>&nbsp;
Authorization Server Configuration Data<br />
<a href="#protecting-a-resource">2.</a>&nbsp;
Protecting a Resource<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#host-access-token">2.1.</a>&nbsp;
Resource Server Obtains Protection API Token<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#resource-set-reg">2.2.</a>&nbsp;
Resource Server Registers Sets of Resources to Be Protected<br />
<a href="#getting-authz-accessing-resource">3.</a>&nbsp;
Getting Authorization and Accessing a Resource<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#r-h-attempt-access">3.1.</a>&nbsp;
Client Attempts to Access Protected Resource at Resource Server<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#no-rpt">3.1.1.</a>&nbsp;
Client Presents No Requester Permission Token<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#insufficient-rpt">3.1.2.</a>&nbsp;
Client Presents a Requester Permission Token That Has Insufficient Permission<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sufficient-rpt">3.1.3.</a>&nbsp;
Client Presents a Valid Requester Permission Token with Sufficient Permissions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#h-am-register-permission">3.2.</a>&nbsp;
Resource Server Registers a Permission With Authorization Server<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#h-am-rpt-status">3.3.</a>&nbsp;
Resource Server Determines the Requester Permission Token Status<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uma-bearer-token-profile">3.3.1.</a>&nbsp;
UMA Bearer Token Profile<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#r-am-obtain-permission">3.4.</a>&nbsp;
Client Asks Authorization Server for Requester Permission Token and Permission<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#authz-api-token">3.4.1.</a>&nbsp;
Client Obtains Authorization API Token<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#authz-permission-token">3.4.2.</a>&nbsp;
Client Obtains Requester Permission Token<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#r-am-authz-scope">3.4.3.</a>&nbsp;
Client Asks for Authorization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#authz-flows">3.5.</a>&nbsp;
Claims-Gathering Flows<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#trusted-claims-human-driven">3.5.1.</a>&nbsp;
Claims-Gathering Flow for Clients Operated by End-Users<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#trusted-claims">3.5.1.1.</a>&nbsp;
UMA OpenID Connect Claim Profile<br />
<a href="#errors">4.</a>&nbsp;
Error Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#oauth-error-response">4.1.</a>&nbsp;
OAuth Error Responses<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uma-error-response">4.2.</a>&nbsp;
UMA Error Responses<br />
<a href="#profiles">5.</a>&nbsp;
Specification of Additional Profiles<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">5.1.</a>&nbsp;
Specifying UMA Profiles<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">5.2.</a>&nbsp;
Specifying UMA Token Profiles<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">5.3.</a>&nbsp;
Specifying UMA Claim Profiles<br />
<a href="#anchor5">6.</a>&nbsp;
Security Considerations<br />
<a href="#anchor6">7.</a>&nbsp;
Privacy Considerations<br />
<a href="#conformance">8.</a>&nbsp;
Conformance<br />
<a href="#IANA">9.</a>&nbsp;
IANA Considerations<br />
<a href="#Acknowledgments">10.</a>&nbsp;
Acknowledgments<br />
<a href="#anchor7">11.</a>&nbsp;
Issues<br />
<a href="#rfc.references1">12.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">12.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">12.2.</a>&nbsp;
Informative References<br />
<a href="#History">Appendix&nbsp;A.</a>&nbsp;
Document History<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>User-Managed Access (UMA) is a profile of OAuth 2.0 <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; September&nbsp;2011.</span><span>)</span></a>. UMA defines how resource owners can control access to their protected resources made by clients operated by arbitrary requesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policy.
</p>
<p>UMA serves numerous use cases where a resource owner outsources authorization for access to their resources, potentially even without the run-time presence of the resource owner. A typical example is the following: a web user (an end-user resource owner) can authorize a web app (client) to gain one-time or ongoing access to a protected resource containing his home address stored at a "personal data store" service (resource server), by telling the resource server to respect access entitlements issued by his authorization service (authorization server). The requesting party operating the client might be the resource owner himself, using a web or native app run by an e-commerce company that needs to know where to ship a purchased item, or it might be his friend who is using an online address book service to collect contact information, or it might be a survey company that uses an autonomous web service to compile population demographics. A variety of scenarios and use cases can be found in <a class='info' href='#UMA-usecases'>[UMA&#8209;usecases]<span> (</span><span class='info'>Maler, E., &ldquo;UMA Scenarios and Use Cases,&rdquo; October&nbsp;2010.</span><span>)</span></a> and <a class='info' href='#UMA-casestudies'>[UMA&#8209;casestudies]<span> (</span><span class='info'>Maler, E., &ldquo;UMA Case Studies,&rdquo; December&nbsp;2012.</span><span>)</span></a>.
</p>
<p>Practical control of access among loosely coupled parties requires more than just messaging protocols. This specification defines only the technical "contract" between UMA-conforming entities; its companion Binding Obligations specification <a class='info' href='#UMA-obligations'>[UMA&#8209;obligations]<span> (</span><span class='info'>Maler, E., &ldquo;Binding Obligations on UMA Participants,&rdquo; April&nbsp;2012.</span><span>)</span></a> defines the expected behaviors of parties operating and using these entities. Parties operating entities that claim to be UMA-conforming MUST provide documentation affirmatively stating their acceptance of the binding obligations contractual framework defined in the Binding Obligations specification.
</p>
<p>In enterprise settings, application access management often involves letting back-office applications serve only as policy enforcement points (PEPs), depending entirely on access decisions coming from a central policy decision point (PDP) to govern the access they give to requesters. This separation eases auditing and allows policy administration to scale in several dimensions. UMA makes use of a separation similar to this, letting the resource owner serve as a policy administrator crafting authorization strategies for resources under their control.
</p>
<p>The UMA protocol can be considered an advanced profile of <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; September&nbsp;2011.</span><span>)</span></a>. In order to increase interoperable communication among the authorization server, resource server, and client, it defines several purpose-built APIs related to the outsourcing of authorization, themselves protected by OAuth in embedded fashion.
</p>
<p>The UMA protocol has three broad phases, as shown in <a class='info' href='#UMA-phases'>Figure&nbsp;1</a>.
</p><br /><hr class="insert" />
<a name="UMA-phases"></a>

<p style='text-align: center'>The Three Phases of the UMA Protocol
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>                                           +--------------+
                                           |   resource   |
          +---------manage (A)------------ |     owner    |
          |                                +--------------+
          |         Phase 1:                      |
          |         protect a                control (B)
          |         resource                      |
          v                                       v
   +------------+               +----------+--------------+
   |            |               |protection|              |
   |  resource  |               |   API    | authorization|
   |   server   |&lt;-protect (C)--| (*needs  |    server    |
   |            |               |   PAT)   |              |
   +------------+               +----------+--------------+
   | protected  |                          | authorization|
   | resource   |                          |     API      |
   |(*needs RPT)|                          | (*needs AAT) |
   +------------+                          +--------------+
          ^                                      |
          |         Phases 2 and 3:         authorize (D)
          |         get authz and                |
          |         access a resource            v
          |                                +--------------+
          +---------access (E)-------------|    client    |
                                           +--------------+

                                         (requesting party)</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In broad strokes, the phases are as follows:</p>
<ol class="text">
<li>Protect a resource (described in <a class='info' href='#protecting-a-resource'>Section&nbsp;2<span> (</span><span class='info'>Protecting a Resource</span><span>)</span></a>).
</li>
<li>Get authorization (described in <a class='info' href='#getting-authz-accessing-resource'>Section&nbsp;3<span> (</span><span class='info'>Getting Authorization and Accessing a Resource</span><span>)</span></a>).
</li>
<li>Access a resource (described along with Phase 2 in <a class='info' href='#getting-authz-accessing-resource'>Section&nbsp;3<span> (</span><span class='info'>Getting Authorization and Accessing a Resource</span><span>)</span></a>).
</li>
</ol>

<p>In more detail, the phases work as follows: </p>
<ol class="text">
<li><em>Protect a resource:</em> This phase accomplishes trust establishment among the resource owner, resource server, and authorization server, as well as enabling the resource server to register with the authorization server descriptions of the resources to be protected. This specification uses <a class='info' href='#OAuth-resource-reg'>[OAuth&#8209;resource&#8209;reg]<span> (</span><span class='info'>Hardjono, T., &ldquo;OAuth 2.0 Resource Set Registration,&rdquo; December&nbsp;2012.</span><span>)</span></a> to enable dynamic introduction and resource registration. In these circumstances, where the resource owner has chosen to use a resource server for managing online resources ("A"), the resource owner introduces this resource server to an authorization server using an OAuth-mediated interaction that results in the authorization server giving the resource server a protection API token (PAT). The resource server then uses the authorization server's protection API to register sets of resources for which protection is being outsourced ("C"). (Out of band of the UMA protocol, the resource owner instructs the authorization server what policies to associated with the registered resource sets ("B").)
</li>
<li><em>Get authorization:</em> This phase involves the client (along with its operator, the "requesting party") for the first time. The client approaches the resource server seeking access to a protected resource ("E"). In order to access it, the client must first obtain a requester permission token (RPT) from the authorization server on behalf of its requesting party. The client and requesting party are then redirected to the authorization server to ask for appropriate authorization data (the form of this data depends on the UMA token profile in use). In doing so, the requesting party must demonstrate to the authorization server that it satisfies the resource owner's policy governing the sought-for resource and scope ("D"). To use the authorization server's authorization API in the first place, the requesting party has to agree to communication with this server for the purpose of seeking authorization, which results in the client obtaining an authorization API token (AAT).
</li>
<li><em>Access a resource:</em> This phase involves the client successfully presenting an RPT that has sufficient authorization data associated with it to the resource server in order to gain access to the desired resource ("E"). In this sense, it is the "happy path" within phase 2.
</li>
</ol>

<p>In deploying UMA, implementers are expected to develop one or more UMA profiles (described in <a class='info' href='#profiles'>Section&nbsp;5<span> (</span><span class='info'>Specification of Additional Profiles</span><span>)</span></a>) that specify and restrict the various UMA protocol options, according to the deployment conditions.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Notational Conventions</h3>

<p>The key words 'MUST', 'MUST NOT', 'REQUIRED', 'SHALL', 'SHALL NOT', 'SHOULD', 'SHOULD NOT', 'RECOMMENDED', 'MAY', and 'OPTIONAL' in this document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>Unless otherwise noted, all the protocol properties and values are case sensitive.
</p>
<a name="terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Basic Terminology</h3>

<p>UMA introduces the following new terms and enhancements of OAuth term definitions.</p>
<blockquote class="text"><dl>
<dt>resource owner</dt>
<dd>The "user" in User-Managed Access; an OAuth resource owner. This is typically an end-user (a natural person) but it can also be a corporation or other legal person.
</dd>
<dt>requesting party</dt>
<dd>An end-user, or a corporation or other legal person, that uses a client to seek access to a protected resource. The requesting party may or may not be the same party as the resource owner.
</dd>
<dt>client</dt>
<dd>An application making protected resource requests with the resource owner's authorization and on the requesting party's behalf.
</dd>
<dt>claim</dt>
<dd>A statement of the value or values of one or more identity attributes of a requesting party. A requesting party may need to provide claims to an authorization server in order to satisfy policy and gain permission for access to a protected resource.
</dd>
<dt>resource set</dt>
<dd>A set of one or more protected resources. In authorization policy terminology, a resource set is the "object" being protected.
</dd>
<dt>scope type</dt>
<dd>A bounded extent of access that is possible to perform on a resource set. In authorization policy terminology, a scope type is one of the potentially many "verbs" that can logically apply to a resource set ("object"). UMA associates scope types with labeled resource sets.
</dd>
<dt>authorization data</dt>
<dd>Data associated with a requester permission token that enables some combination of the authorization server and resource server to determine the correct extent of access to allow to a client. Authorization data is a key part of the definition of an UMA token profile.
</dd>
<dt>permission</dt>
<dd>A scope of access over a particular resource set at a particular resource server that is being asked for by, or being granted to, a requesting party. In authorization policy terminology, a permission includes a "subject" (requesting party), "verbs" (one or more scopes of access), and an "object" (resource set). A permission is one example of authorization data.
</dd>
<dt>permission ticket</dt>
<dd>A correlation handle that is conveyed from an authorization server to a resource server, from a resource server to a client, and ultimately from a client to an authorization server, to enable the authorization server to assess the correct resource owner policies to apply to an access request.
</dd>
</dl></blockquote>

<a name="endpoint-discussion"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Endpoints, Endpoint Protection, and Tokens</h3>

<p>Various UMA entities present protected APIs for other entities to use. These APIs are as follows:</p>
<ul class="text">
<li>The authorization server presents a <em>protection API</em> to the resource server, which encompasses the resource registration API defined by the OAuth introduction specification <a class='info' href='#OAuth-resource-reg'>[OAuth&#8209;resource&#8209;reg]<span> (</span><span class='info'>Hardjono, T., &ldquo;OAuth 2.0 Resource Set Registration,&rdquo; December&nbsp;2012.</span><span>)</span></a>, as well as additional functions standardized by this specification. This API is OAuth-protected, requiring a resource server to obtain from the authorization server an OAuth access token called a <em>protection API token (PAT)</em>.
</li>
<li>The authorization server presents an <em>authorization API</em> to the client, as defined wholly by this specification. This API is OAuth-protected, requiring a client and its requesting party to obtain from the authorization server an OAuth access token, referred to in this specification as an <em>authorization API token (AAT)</em> to distinguish it from other tokens with other purposes.
</li>
<li>The resource server presents a <em>protected resource</em> to the client, which can be considered an application-specific or proprietary API. This API is protected by the UMA profile of OAuth, requiring a client to obtain from the authorization server an OAuth access token, referred to in this specification as a <em>requester permission token (RPT)</em> to distinguish it from other tokens with other purposes.
</li>
</ul>

<p>The authorization server presents standard OAuth endpoints for token issuance and resource owner authorization in protecting its own UMA APIs, as follows. Resource servers asking to use the protection API would be issued a PAT. Clients and requesting parties asking to use the authorization API would be issued an AAT.</p>
<blockquote class="text"><dl>
<dt>token endpoint</dt>
<dd>Part of standard OAuth, as profiled by UMA. The endpoint at which the resource server asks for a PAT on the resource owner's behalf. Also the endpoint at which the client asks for an AAT on the requesting party's behalf. (The authorization server may also choose to issue a refresh token.) This specification makes the OAuth token profile "bearer" mandatory for the authorization server to implement. It can declare its ability to handle other token profiles.
</dd>
<dt>user authorization endpoint</dt>
<dd>Part of standard OAuth, as profiled by UMA; used when the authorization code grant type (REQUIRED for the authorization server to implement) is being used. The endpoint to which the resource server redirects an end-user resource owner to authorize the former to use this authorization server in outsourcing resource protection. Also the endpoint to which the client redirects the end-user requesting party to authorize the former to use this authorization server in seeking access.
</dd>
</dl></blockquote>

<p>The authorization server presents the following endpoints to the resource server as part of its protection API; these endpoints MUST be OAuth-protected and require a PAT for access, for which the "http://docs.kantarainitiative.org/uma/scopes/prot.json" OAuth scope is required:</p>
<blockquote class="text"><dl>
<dt>resource set registration endpoint</dt>
<dd>The endpoint at which the resource server registers resource sets it wants the authorization server to protect, as defined by <a class='info' href='#OAuth-resource-reg'>[OAuth&#8209;resource&#8209;reg]<span> (</span><span class='info'>Hardjono, T., &ldquo;OAuth 2.0 Resource Set Registration,&rdquo; December&nbsp;2012.</span><span>)</span></a>. The "http://docs.kantarainitiative.org/uma/scopes/prot.json" scope is a superset of the scope that governs usage of the resource set registration endpoint.
</dd>
<dt>permission registration endpoint</dt>
<dd>The endpoint at which the resource server registers permissions that it anticipates a client will shortly be asking for from the authorization server.
</dd>
<dt>introspection endpoint</dt>
<dd>The endpoint at which the resource server forwards an RPT that has accompanied an access request to learn what authorization data is associated with it, as defined by <a class='info' href='#OAuth-introspection'>[OAuth&#8209;introspection]<span> (</span><span class='info'>Richer, J., &ldquo;OAuth 2.0 Token Introspection,&rdquo; November&nbsp;2012.</span><span>)</span></a>. This specification defines an UMA token profile, "bearer", which is mandatory for the authorization server to implement and which, if used, REQUIRES the resource server to use this endpoint (see <a class='info' href='#h-am-rpt-status'>Section&nbsp;3.3<span> (</span><span class='info'>Resource Server Determines the Requester Permission Token Status</span><span>)</span></a>). The "http://docs.kantarainitiative.org/uma/scopes/prot.json" scope is a superset of the scope that governs usage of the token introspection endpoint.
</dd>
</dl></blockquote>

<p>The authorization server presents the following endpoints to the client as part of its authorization API; these endpoints are OAuth-protected and require an AAT for access, for which the "http://docs.kantarainitiative.org/uma/scopes/authorization" OAuth scope is required:</p>
<blockquote class="text"><dl>
<dt>RPT endpoint</dt>
<dd>The endpoint at which the client asks the authorization server for the issuance of an RPT relating to this requesting party, resource server, and authorization server.
</dd>
<dt>permission request endpoint</dt>
<dd>The endpoint at which the client asks for authorization data to be associated with an RPT to enable authorized access.
</dd>
</dl></blockquote>

<p>The resource server presents one or more protected resource endpoints to the client; these endpoints are protected by the UMA profile of OAuth and require an RPT with sufficient authorization data to permit access:</p>
<blockquote class="text"><dl>
<dt>protected resource endpoint</dt>
<dd>An application-specific endpoint at which a client attempts to access resources. This can be a singular API endpoint, one of a set of API endpoints, a URI corresponding to an HTML document, or any other URI.
</dd>
</dl></blockquote>

<p>The authorization server has the opportunity to manage the validity periods of the access tokens, the corresponding refresh tokens where applicable, and even the client credentials that it issues. Different lifetime strategies may be suitable for different resources and scopes of access, and the authorization server has the opportunity to give the resource owner control through policy. These options are all outside the scope of this specification.
</p>
<a name="scope-discussion"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
Scope Types, Resource Sets, Permissions, and Authorization</h3>

<p>UMA extends the OAuth concept of a "scope" by defining scope types as applying to labeled resource sets, rather than leaving the relevant resources (such as API endpoints or URIs) implicit. A resource set can have any number of scope types, which together describe the universe of actions that <em>can be</em> taken on this protected resource set. For example, a resource set representing a status update API might have scopes that include adding an update or reading updates. A resource set representing a photo album might have scopes that include viewing a slideshow or printing the album. Resource servers register resource sets and their scope types when there is not yet any particular requesting party or client in the picture.
</p>
<p>Resource sets and scope types have meaning only to resource servers and their users, in the same way that application-specific protected resource APIs have meaning only to these entities. The authorization server is merely a conveyor of labels and descriptions for these constructs, to help the resource owner set policies that guide eventual authorization processes.
</p>
<p>A permission, in contrast to a scope type, reflects an <em>actual</em> entitlement to access a resource set using one or more scope types, as the result of an authorization process undergone by a specific requesting party. A resource server registers a permission request with an authorization server on behalf of a client (and its requesting partie) that has attempted access, and transmits the resulting permission ticket to the client. The client subsequently asks the authorization server for authorization data to be associated with its RPT. If the UMA token profile is in use, the authorization server grants (or denies) the permission to the requesting party. (If another token profile is in use, the authorization server might generate a different type of authorization data, such as an authorization decision or a package of the claims it has collected.)
</p>
<p>An RPT is bound to a requesting party, the client being used by that party, the resource server at which protected resources of interest reside, and the authorization server that protects those resources. It becomes associated with as many pieces of authorization data as are appropriate for gaining authorized access to resources protected at that resource server by any single authorization server (even if that data applies to resources managed by two or more different resource owners at the same resource server using the same authorization server).
</p>
<p>In the case of the UMA "bearer" token profile, each individual permission is associated with the resource owner whose policies drove the authorization process. This enables meaningful, auditable, and potentially legally enforceable authorization for access (see <a class='info' href='#UMA-obligations'>[UMA&#8209;obligations]<span> (</span><span class='info'>Maler, E., &ldquo;Binding Obligations on UMA Participants,&rdquo; April&nbsp;2012.</span><span>)</span></a>). Permissions have a validity period that the authorization server has the opportunity to control (independently or with input from the resource owner). These control options are outside the scope of this specification.
</p>
<a name="am-endpoints"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.5"></a><h3>1.5.&nbsp;
Authorization Server Configuration Data</h3>

<p>The authorization server MUST provide configuration data to other entities it interacts with in a<a class='info' href='#RFC4627'>JSON<span> (</span><span class='info'>Crockford, D., &ldquo;The application/json Media Type for JavaScript Object Notation (JSON),&rdquo; July&nbsp;2006.</span><span>)</span></a> [RFC4627] document that resides in an /uma-configuration directory at at its hostmeta <a class='info' href='#RFC6415'>[RFC6415]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;Web Host Metadata,&rdquo; October&nbsp;2011.</span><span>)</span></a> location. The configuration data documents major conformance options supported by the authorization server (described further in <a class='info' href='#conformance'>Section&nbsp;8<span> (</span><span class='info'>Conformance</span><span>)</span></a>) and protection and authorization API endpoints (as described in <a class='info' href='#endpoint-discussion'>Section&nbsp;1.3<span> (</span><span class='info'>Endpoints, Endpoint Protection, and Tokens</span><span>)</span></a>). (At the appropriate time, this section will instead profile or extend the <a class='info' href='#OAuth-linktypes'>[OAuth&#8209;linktypes]<span> (</span><span class='info'>Mills, W., &ldquo;Link Type Registrations for OAuth2,&rdquo; November&nbsp;2012.</span><span>)</span></a> specification.)
</p>
<p>The configuration data has the following properties. All endpoint URIs supplied SHOULD require the use of a transport-layer security mechanism such as TLS.</p>
<blockquote class="text"><dl>
<dt>version</dt>
<dd>REQUIRED. The version of the UMA core protocol to which this authorization server conforms. The value MUST be the string "1.0".
</dd>
<dt>issuer</dt>
<dd>REQUIRED. A URI indicating the party operating the authorization server.
</dd>
<dt>dynamic_client_endpoint</dt>
<dd>OPTIONAL. The endpoint to use for performing dynamic client registration through <a class='info' href='#DynClientReg'>.<span> (</span><span class='info'>Richer, J., &ldquo;OAuth Dynamic Client Registration Protocol,&rdquo; November&nbsp;2012.</span><span>)</span></a> [DynClientReg]
</dd>
<dt>oauth_token_profiles_supported</dt>
<dd>REQUIRED. PAT and AAT profiles produced by this authorization server. The property value is an array of string values. Currently the only string value for this property defined by this specification is "bearer", corresponding to the OAuth bearer token profile <a class='info' href='#OAuth-bearer'>[OAuth&#8209;bearer]<span> (</span><span class='info'>, &ldquo;The OAuth 2.0 Authorization Framework: Bearer Token Usage,&rdquo; October&nbsp;2012.</span><span>)</span></a>. The authorization server is REQUIRED to support this profile, and to supply this string value explicitly. The authorization server MAY declare its support for additional access token profiles by providing a unique absolute URI in a string value in the array for each one.
</dd>
<dt>uma_token_profiles_supported</dt>
<dd>REQUIRED. RPT types produced by this authorization server. The property value is an array of string values. Currently the only string value for this property defined by this specification is "bearer", whose associations the resource server MUST determine through a token introspection interaction with the authorization server (see <a class='info' href='#h-am-rpt-status'>Section&nbsp;3.3<span> (</span><span class='info'>Resource Server Determines the Requester Permission Token Status</span><span>)</span></a> for the definition of this profile). The authorization server is REQUIRED to support the UMA bearer token profile, and to supply this string value explicitly. The authorization server MAY declare its support for RPTs using additional UMA token profiles by providing a unique absolute URI in a string value in the array for each one.
</dd>
<dt>oauth_grant_types_supported</dt>
<dd>REQUIRED. OAuth grant types supported by this authorization server in issuing PATs and AATs. The property value is an array of string values. Each string value MUST be one of the grant_type values defined in <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; September&nbsp;2011.</span><span>)</span></a>, or alternatively an extension grant type indicated by a unique absolute URI.
</dd>
<dt>claim_profiles_supported</dt>
<dd>OPTIONAL. Claim formats and associated sub-protocols for gathering claims from requesting parties, as supported by this authorization server. The property value is an array of string values. Currently the only string value for this property defined by this specification is "openid", for which details are supplied in <a class='info' href='#trusted-claims'>Section&nbsp;3.5.1.1<span> (</span><span class='info'>UMA OpenID Connect Claim Profile</span><span>)</span></a>. The authorization server MAY declare its support for additional claim profiles by assigning a unique absolute URI in a string value in the array for each one.
</dd>
<dt>token_endpoint</dt>
<dd>REQUIRED. The endpoint URI at which the resource server or client asks the authorization server for a PAT or AAT, respectively. A requested scope of "http://docs.kantarainitiative.org/uma/scopes/prot.json" results in a PAT. A requested scope of "http://docs.kantarainitiative.org/uma/scopes/authorization" results in an AAT. Available HTTP methods are as defined by <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; September&nbsp;2011.</span><span>)</span></a> for a token endpoint.
</dd>
<dt>user_endpoint</dt>
<dd>REQUIRED. The endpoint URI at which the resource server gathers the consent of the end-user resource owner or the client gathers the consent of the end-user requesting party, if the "authorization_code" grant type is used. Available HTTP methods are as defined by <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; September&nbsp;2011.</span><span>)</span></a> for an end-user authorization endpoint.
</dd>
<dt>permission_registration_endpoint</dt>
<dd>REQUIRED. The endpoint URI at which the resource server registers permissions with the authorization server for which a client will be seeking authorization on its requesting party's behalf (see <a class='info' href='#h-am-register-permission'>Section&nbsp;3.2<span> (</span><span class='info'>Resource Server Registers a Permission With Authorization Server</span><span>)</span></a>). A PAT MUST accompany requests to this protected endpoint.
</dd>
<dt>rpt_endpoint</dt>
<dd>REQUIRED. The endpoint URI at which the client ask the authorization server for an RPT. An AAT token MUST accompany requests to this protected endpoint.
</dd>
<dt>rpt_status_endpoint</dt>
<dd>REQUIRED. The endpoint URI at which the resource server introspects an RPT presented to it by a client (see <a class='info' href='#h-am-rpt-status'>Section&nbsp;3.3<span> (</span><span class='info'>Resource Server Determines the Requester Permission Token Status</span><span>)</span></a>). A PAT MUST accompany requests to this protected endpoint.
</dd>
<dt>permission_request_endpoint</dt>
<dd>REQUIRED. The endpoint URI at which the client asks, on its requesting party's behalf, to have authorization data associated with its RPT. An AAT MUST accompany requests to this protected endpoint.
</dd>
</dl></blockquote>

<p>Example of authorization server configuration data that resides at https://example.com/.well-known/uma-configuration (note the use of https: for endpoints throughout):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>{
"version":"1.0",
"issuer":"https://example.com",
"dynamic_client_endpoint":"https://as.example.com/dyn_client_reg_uri",
"oauth_token_profiles_supported":[
  "bearer"
],
"uma_token_profiles_supported":[
  "bearer"
],
"oauth_grant_types_supported":[
  "authorization_code"
],
"claim_profiles_supported":[
  "openid"
],
"token_endpoint":"https://as.example.com/token_uri",
"user_endpoint":"https://as.example.com/user_uri",
"resource_set_registration_endpoint":"https://as.example.com/rs/rsrc_uri",
"rpt_status_endpoint":"https://as.example.com/rs/status_uri",
"permission_registration_endpoint":"https://as.example.com/rs/perm_uri",
"rpt_endpoint":"https://as.example.com/client/rpt_uri",
"permission_request_endpoint":"https://as.example.com/client/perm_uri"
}</pre></div>
<p>Authorization server configuration data MAY contain extension properties that are not defined in this specification. Extension names that are unprotected from collisions are outside the scope of the current specification.
</p>
<a name="protecting-a-resource"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Protecting a Resource</h3>

<p>Phase 1 of UMA is protecting a resource. The resource owner, resource server, and authorization server perform the following steps to successfully complete Phase 1 (assuming that the resource server has discovered the authorization server's configuration data and endpoints as needed):</p>
<ul class="text">
<li>The resource server and authorization server establish mutual trust through the issuance of client credentials to the resource server. It is OPTIONAL for the client credentials to be provided dynamically through <a class='info' href='#DynClientReg'>[DynClientReg]<span> (</span><span class='info'>Richer, J., &ldquo;OAuth Dynamic Client Registration Protocol,&rdquo; November&nbsp;2012.</span><span>)</span></a>); alternatively, they MAY use a static process.
</li>
<li>The resource owner, resource server, and authorization server establish three-way trust through the issuance of a PAT. See <a class='info' href='#host-access-token'>Section&nbsp;2.1<span> (</span><span class='info'>Resource Server Obtains Protection API Token</span><span>)</span></a> for additional details.
</li>
<li>The resource server registers any resource sets with the authorization server that are intended to be protected. See <a class='info' href='#resource-set-reg'>Section&nbsp;2.2<span> (</span><span class='info'>Resource Server Registers Sets of Resources to Be Protected</span><span>)</span></a> for additional details.
</li>
</ul>

<a name="host-access-token"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Resource Server Obtains Protection API Token</h3>

<p>In this step, the resource server acquires a PAT from the authorization server. The token represents the approval of the resource owner for this resource server to trust this authorization server for protecting resources belonging to this resource owner. It is OPTIONAL for the resource owner to introduce the resource server to the authorization server dynamically through the process defined in <a class='info' href='#OAuth-resource-reg'>[OAuth&#8209;resource&#8209;reg]<span> (</span><span class='info'>Hardjono, T., &ldquo;OAuth 2.0 Resource Set Registration,&rdquo; December&nbsp;2012.</span><span>)</span></a>); alternatively, they MAY use a static process that may or may not directly involve the resource owner at introduction time.
</p>
<p>The resource server MUST use OAuth 2.0 <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; September&nbsp;2011.</span><span>)</span></a> to obtain the PAT. Here the resource server acts in the role of an OAuth client requesting the "http://docs.kantarainitiative.org/uma/scopes/prot.json" scope, which authorizes it to use the authorization server's resource set registration endpoint (as defined in <a class='info' href='#OAuth-resource-reg'>[OAuth&#8209;resource&#8209;reg]<span> (</span><span class='info'>Hardjono, T., &ldquo;OAuth 2.0 Resource Set Registration,&rdquo; December&nbsp;2012.</span><span>)</span></a>) as well as additional protection API endpoints. Once the resource server has obtained its PAT, it presents it to the authorization server at various protection API endpoints.
</p>
<p>(NOTE: The "http://docs.kantarainitiative.org/uma/scopes/prot.json" scope keyword is a URI that resolves to a JSON-encoded scope description, in the fashion of UMA scope types. This scope description is non-normative.)
</p>
<p>The authorization server MAY support the use of any OAuth grant type for PAT issuance, but MUST support the authorization_code grant type, and SHOULD support the SAML bearer token grant type <a class='info' href='#OAuth-SAML'>[OAuth&#8209;SAML]<span> (</span><span class='info'>Campbell, B., &ldquo;SAML 2.0 Bearer Assertion Grant Type Profile for OAuth 2.0,&rdquo; August&nbsp;2011.</span><span>)</span></a> (urn:ietf:params:oauth:grant-type:saml2-bearer) if it anticipates working with resource servers that are operating in environments where the use of SAML is prevalent. The authorization server MUST indicate all grant types it supports for PAT issuance in its configuration data.
</p>
<a name="resource-set-reg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Resource Server Registers Sets of Resources to Be Protected</h3>

<p>Once the resource server has received a PAT, for any of the resource owner's sets of resources that are to be protected by this authorization server, it registers these resource sets in a timely fashion. To do this, the resource server uses the resource set registration API defined in <a class='info' href='#OAuth-resource-reg'>[OAuth&#8209;resource&#8209;reg]<span> (</span><span class='info'>Hardjono, T., &ldquo;OAuth 2.0 Resource Set Registration,&rdquo; December&nbsp;2012.</span><span>)</span></a>.
</p>
<p>Note: The resource server is free to offer the option to protect any subset of the resource owner's resources using different authorization servers or other means entirely, or to protect some resources and not others. Additionally, the choice of protection regimes can be made explicitly by the resource owner or implicitly by the resource server. Any such partitioning by the resource server or owner is outside the scope of this specification.
</p>
<p>On successfully registering a resource set, the RS MUST use access control mechanisms to limit access to any resources corresponding to this resource set, relying on the AS to supply currently valid permissions for authorized access. The RS MUST outsource protection to the AS according to the currently registered state of a resource set. This requirement holds true so long as the RS has one or more registsred resource sets.
</p>
<a name="getting-authz-accessing-resource"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Getting Authorization and Accessing a Resource</h3>

<p>Phase 2 of UMA is getting authorization, and phase 3 is accessing a resource. In these phases, an authorization server orchestrates and controls clients' access (on their requesting parties' behalf) to a resource owner's protected resources at a resource server, under conditions dictated by that resource owner.
</p>
<p>Phase 3 is merely the successful completion of a client's access attempt that initially involved several embedded interactions among the client, requesting party, authorization server, and resource server in phase 2. Phase 2 always begins with the client attempting access at a protected resource endpoint at the resource server. How the client came to learn about this endpoint is out of scope for this specification. The resource owner might, for example, have advertised its availability publicly on a blog or other website, listed it in a discovery service, or emailed a link to a particular intended requesting party.
</p>
<p>The resource server responds to the client's access request in one of several ways depending on the circumstances of the request, either immediately or having first performed one or more embedded interactions with the authorization server. Depending on the nature of the resource server's response to an failed access attempt, the client and its operator engage in embedded interactions with the authorization server before re-attempting access.
</p>
<p>The interactions are as follows. Each interaction MAY be the last, if the client chooses not to continue pursuing the access attempt or the resource server chooses not to continue facilitating it.</p>
<ol class="text">
<li>The client attempts access at a particular protected resource at a resource server (see <a class='info' href='#r-h-attempt-access'>Section&nbsp;3.1<span> (</span><span class='info'>Client Attempts to Access Protected Resource at Resource Server</span><span>)</span></a>).
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>If the access attempt is unaccompanied by an RPT, the resource server responds immediately with an HTTP 401 (Unauthorized) response and instructions on where to go to obtain one (see <a class='info' href='#authz-permission-token'>Section&nbsp;3.4.2<span> (</span><span class='info'>Client Obtains Requester Permission Token</span><span>)</span></a>).
</dd>
<dt>B.</dt>
<dd>If the access attempt was accompanied by an RPT, the resource server checks the RPT's status (see <a class='info' href='#h-am-rpt-status'>Section&nbsp;3.3<span> (</span><span class='info'>Resource Server Determines the Requester Permission Token Status</span><span>)</span></a>).
<ol class="text">
<li>If the RPT is invalid (for example, it is not applicable to this resource server), the resource server responds to the client with an HTTP 401 (Unauthorized) response and instructions on where to go to obtain a token (see <a class='info' href='#authz-permission-token'>Section&nbsp;3.4.2<span> (</span><span class='info'>Client Obtains Requester Permission Token</span><span>)</span></a>).
</li>
<li>If the RPT is valid but has insufficient permission, the resource server registers a suitable permission request on the client's behalf at the authorization server (see <a class='info' href='#h-am-register-permission'>Section&nbsp;3.2<span> (</span><span class='info'>Resource Server Registers a Permission With Authorization Server</span><span>)</span></a>), and then responds to the client with an HTTP 403 (Forbidden) response and instructions on where to go to ask for authorization (see <a class='info' href='#insufficient-rpt'>Section&nbsp;3.1.2<span> (</span><span class='info'>Client Presents a Requester Permission Token That Has Insufficient Permission</span><span>)</span></a>).
</li>
<li>If the RPT is valid, and if the authorization data associated with the token is consistent with allowing access, the resource server responds to the client's access attempt with an HTTP 200 (OK) response and a representation of the resource (see <a class='info' href='#sufficient-rpt'>Section&nbsp;3.1.3<span> (</span><span class='info'>Client Presents a Valid Requester Permission Token with Sufficient Permissions</span><span>)</span></a>).
</li>
</ol>
</dd>
</dl></blockquote>
</li>
<li>If the client (possessing no RPT or an invalid RPT) received a 401 response and an RPT endpoint, it then requests an RPT from that endpoint (see <a class='info' href='#authz-permission-token'>Section&nbsp;3.4.2<span> (</span><span class='info'>Client Obtains Requester Permission Token</span><span>)</span></a>).
</li>
<li>If the client (posessing a valid RPT) received a 403 response and a permission ticket, it then asks the authorization server for authorization that matches the ticket (<a class='info' href='#r-am-authz-scope'>Section&nbsp;3.4.3<span> (</span><span class='info'>Client Asks for Authorization</span><span>)</span></a>). If the authorization server needs requesting party claims in order to assess this client's authorization, it engages in a claims-gathering flow with the requesting party (see <a class='info' href='#authz-flows'>Section&nbsp;3.5<span> (</span><span class='info'>Claims-Gathering Flows</span><span>)</span></a>).
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>If the client does not already have an AAT at the appropriate authorization server to be able to use its permission request endpoint, it first obtains one (see <a class='info' href='#authz-api-token'>Section&nbsp;3.4.1<span> (</span><span class='info'>Client Obtains Authorization API Token</span><span>)</span></a>).
</dd>
</dl></blockquote>
</li>
</ol>

<p>The interactions are described in detail in the following sections.
</p>
<a name="r-h-attempt-access"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Client Attempts to Access Protected Resource at Resource Server</h3>

<p>This interaction assumes that the resource server has previously registered with an authorization server one or more resource sets that correspond to the resource to which access is being attempted, such that the resource server considers this resource to be protected by a particular authorization server.
</p>
<p>The client typically attempts to access the desired resource at the resource server directly (for example, when an end-user requesting party clicks on a thumbnail representation of the resource). The client is expected to discover, or be provisioned or configured with, knowledge of the protected resource and its location out of band. Further, the client is expected to acquire its own knowledge about the application-specific methods made available by the resource server for operating on this protected resource (such as viewing it with a GET method, or transforming it with some complex API call) and the possible scopes of access.
</p>
<p>Example of a request carrying no RPT:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET /album/photo.jpg HTTP/1.1
Host: photoz.example.com
...
</pre></div>
<p>Example of a request carrying an RPT using the UMA "bearer" token profile:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET /album/photo.jpg HTTP/1.1
Authorization: Bearer vF9dft4qmT
Host: photoz.example.com
...
</pre></div>
<p>The resource server responds in one of the following ways.
</p>
<a name="no-rpt"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
Client Presents No Requester Permission Token</h3>

<p>If the client does not present any access token with the request, the resource server MUST return an HTTP 401 (Unauthorized) status code, along with providing the authorization server's URI in an "am_uri" property to facilitate authorization server configuration data discovery, including discovery of the endpoint where the client can request an RPT (<a class='info' href='#authz-permission-token'>Section&nbsp;3.4.2<span> (</span><span class='info'>Client Obtains Requester Permission Token</span><span>)</span></a>).
</p>
<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 401 Unauthorized
   WWW-Authenticate: UMA realm="example",
    host_id="photoz.example.com",
    am_uri="http://am.example.com"
   ...
</pre></div>
<a name="insufficient-rpt"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2"></a><h3>3.1.2.&nbsp;
Client Presents a Requester Permission Token That Has Insufficient Permission</h3>

<p>If the client presents an RPT with its request, the resource server SHOULD determine the RPT's status (see <a class='info' href='#h-am-rpt-status'>Section&nbsp;3.3<span> (</span><span class='info'>Resource Server Determines the Requester Permission Token Status</span><span>)</span></a>). If the RPT is invalid, the resource server redirects the client to the RPT endpoint at the authorization server to obtain a correct RPT (see <a class='info' href='#authz-permission-token'>Section&nbsp;3.4.2<span> (</span><span class='info'>Client Obtains Requester Permission Token</span><span>)</span></a>).
</p>
<p>If the RPT is valid but has insufficient permission for the type of access sought, the resource server SHOULD register a permission with the authorization server that would suffice for that scope of access (see <a class='info' href='#h-am-register-permission'>Section&nbsp;3.2<span> (</span><span class='info'>Resource Server Registers a Permission With Authorization Server</span><span>)</span></a>), and then respond to the client with the HTTP 403 (Forbidden) status code, along with providing the authorization server's URI in the header of the message and the permission ticket it just received from the authorization server in the body in JSON form.
</p>
<p>Example of the host's response:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 403 Forbidden
WWW-Authenticate: UMA realm="example",
  host_id="photoz.example.com",
  am_uri="http://am.example.com"
  error="insufficient_scope"

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}
</pre></div>
<a name="sufficient-rpt"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.3"></a><h3>3.1.3.&nbsp;
Client Presents a Valid Requester Permission Token with Sufficient Permissions</h3>

<p>If the RPT's status is associated with authorization data that is consistent with authorized access of the scope sought by the client (see <a class='info' href='#h-am-rpt-status'>Section&nbsp;3.3<span> (</span><span class='info'>Resource Server Determines the Requester Permission Token Status</span><span>)</span></a>), the resource server MUST give access to the desired resource.
</p>
<p>Example of the resource server's response:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
Content-Type: image/jpeg
...

/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja
3kAAQAEAAAAPAAA/+4ADkFkb2JlAGTAAAAAAf
/bAIQABgQEBAUEBgUFBgkGBQYJCwgGBggLDAo
KCwoKDBAMDAwMDAwQDA4PEA8ODBMTFBQTExwb
</pre></div>
<p>This response constitutes the conclusion of [hase 3 of UMA.
</p>
<p>The resource server MUST NOT give access where the token's status is not associated with sufficient authorization data for the attempted scope of access.
</p>
<a name="h-am-register-permission"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Resource Server Registers a Permission With Authorization Server</h3>

<p>In response to receiving an access request accompanied by an RPT that is invalid or has insufficient permissions, the resource server SHOULD register a permission with the authorization server that would be sufficient for the type of access sought. The authorization server returns a permission ticket for the resource server to give to the client in its response.
</p>
<p>The permission ticket is a short-lived opaque structure whose form is determined by the authorization server. The ticket value MUST be securely random (for example, not merely part of a predictable sequential series), to avoid denial-of-service attacks. Since the ticket is an opaque structure from the point of view of the client, the authorization server is free to include information regarding expiration time within the opaque ticket for its own consumption. When the client subsequently asks the authorization server for authorization data to be associated with its RPT, it will submit this ticket to the authorization server.
</p>
<p>The resource server registers the permission using the POST method at the authorization server's permission registration endpoint. The resource server MUST provide its valid PAT in order to get access to this endpoint. The body of the HTTP request message contains a JSON document providing the requested permission.
</p>
<p>The requested scope is an object with the name "requested_permission" and the following properties:</p>
<blockquote class="text"><dl>
<dt>resource_set_id</dt>
<dd>REQUIRED. The identifier for a resource set, access to which this client is seeking access. The identifier MUST correspond to a resource set that was previously registered.
</dd>
<dt>scopes</dt>
<dd>REQUIRED. An array referencing one or more identifiers of scope types to which access is needed for this resource set. Each scope type identifier MUST correspond to a scope type that was registered by this resource server for the referenced resource set.
</dd>
</dl></blockquote>

<p>Example of an HTTP request that registers a permission at the authorization server's permission registration endpoint:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
POST /host/scope_reg_uri/photoz.example.com HTTP/1.1
Content-Type: application/json
Host: am.example.com

{
  "resource_set_id": "112210f47de98100",
  "scopes": [
      "http://photoz.example.com/dev/actions/view",
      "http://photoz.example.com/dev/actions/all"
  ]
}
</pre></div>
<p>If the registration request is successful, the authorization server responds with an HTTP 201 (Created) status code and includes the Location header in its response as well as the "ticket" property in the JSON-formatted body.
</p>
<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 201 Created
Content-Type: application/uma-permission-ticket+json
Location: https://am.example.com/permreg/host/photoz.example.com/5454345rdsaa4543
...

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}
</pre></div>
<p>If the registration request is authenticated properly but fails due to other reasons, the authorization server responds with an HTTP 400 (Bad Request) status code and includes one of the following UMA error codes (see <a class='info' href='#uma-error-response'>Section&nbsp;4.2<span> (</span><span class='info'>UMA Error Responses</span><span>)</span></a>):</p>
<blockquote class="text"><dl>
<dt>invalid_resource_set_id</dt>
<dd>The provided resource set identifier was not found at the authorization server.
</dd>
<dt>invalid_scope</dt>
<dd>At least one of the scopes included in the request was not registered previously by this resource server.
</dd>
</dl></blockquote>

<a name="h-am-rpt-status"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Resource Server Determines the Requester Permission Token Status</h3>

<p>On receiving an RPT, the resource server MUST ascertain its status before granting or denying access to the client. An RPT is associated with a set of authorization data that governs whether the client is authorized for access. The token's nature and format are dictated by its profile; the profile might allow it to be self-contained, such that the resource server is able to ascertain its status locally, or might require or allow the resource server to make a run-time introspection request of the authorization server that issued the token using <a class='info' href='#OAuth-introspection'>[OAuth&#8209;introspection]<span> (</span><span class='info'>Richer, J., &ldquo;OAuth 2.0 Token Introspection,&rdquo; November&nbsp;2012.</span><span>)</span></a>.
</p>
<p>This specification makes one type of RPT mandatory to implement: the UMA bearer token profile, as defined in <a class='info' href='#uma-bearer-token-profile'>Section&nbsp;3.3.1<span> (</span><span class='info'>UMA Bearer Token Profile</span><span>)</span></a>. Alternate RPT profiles MAY define their own unique token formats and MAY require, allow, or prohibit use of the token introspection endpoint.
</p>
<a name="uma-bearer-token-profile"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1"></a><h3>3.3.1.&nbsp;
UMA Bearer Token Profile</h3>

<p>This section defines the format and protocol requirements for the UMA bearer token profile. An authorization server MUST support the UMA bearer token profile and MUST indicate its support in the "uma_token_profiles_supported" property in its configuration data (see <a class='info' href='#am-endpoints'>Section&nbsp;1.5<span> (</span><span class='info'>Authorization Server Configuration Data</span><span>)</span></a>).
</p>
<p>On receiving an RPT of the "Bearer" type in an authorization header from a client making an access attempt, the resource server MUST use the authorization server's token introspection endpoint <a class='info' href='#OAuth-introspection'>[OAuth&#8209;introspection]<span> (</span><span class='info'>Richer, J., &ldquo;OAuth 2.0 Token Introspection,&rdquo; November&nbsp;2012.</span><span>)</span></a> to retrieve the RPT's associated authorization data. In order to ask the authorization server for an RPT's status, the host makes the request to the authorization server with a POST request to the authorization server's token introspection endpoint. The body of the HTTP request message contains a JSON document providing the RPT. The host MUST provide its own PAT in the request in order to gain access to the RPT status endpoint.
</p>
<p>Example of a request to the RPT status endpoint that provides the PAT in the header:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
POST /token_status HTTP/1.1
Host: am.example.com
Authorization: Bearer vF9dft4qmT
...

{
  "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
  "resource_set_id": "112210f47de98100",
  "host_id": "photoz.example.com"
}
</pre></div>
<p>The authorization server returns the RPT's status in an HTTP response using the 200 OK status code, containing a JSON document supplying the RPT's associated permissions. The RPT status description either contains all of the permissions that are currently valid for this RPT or indicates that the RPT is invalid (see <a class='info' href='#scope-discussion'>Section&nbsp;1.4<span> (</span><span class='info'>Scope Types, Resource Sets, Permissions, and Authorization</span><span>)</span></a>). The authorization server MAY set a cache period for the returned RPT status description that allows the host to reuse it over some period of time when it later sees the same RPT.
</p>
<p>The status description for a valid RPT is a JSON array of zero or more permission objects, each with the following properties (this needs to be synced up with the token introspection spec):</p>
<blockquote class="text"><dl>
<dt>resource_set_id</dt>
<dd>REQUIRED. A string that uniquely identifies the resource set, access to which has been granted to this client on behalf of this requesting party. The identifier MUST correspond to a resource set that was previously registered as protected.
</dd>
<dt>scopes</dt>
<dd>REQUIRED. An array referencing one or more URIs of scopes to which access was granted for this resource set. Each scope MUST correspond to a scope that was registered by this host for the referenced resource set.
</dd>
<dt>exp</dt>
<dd>REQUIRED. An integer representing the expiration time on or after which the permission MUST NOT be accepted for authorized access. The processing of the exp property requires that the current date/time MUST be before the expiration date/time listed in the exp claim. Host implementers MAY provide for some small leeway, usually no more than a few minutes, to account for clock skew.
</dd>
</dl></blockquote>

<p>Example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store
...

[
  {
    "resource_set_id": "112210f47de98100",
    "scopes": [
      "http://photoz.example.com/dev/actions/view",
      "http://photoz.example.com/dev/actions/all"
    ],
    "exp": 1300819380
  }
]
</pre></div>
<p>The token status description for an invalid RPT is a JSON structure, as follows.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
Content-Type: application/json
...

{
  "rpt_status": "invalid"
}
</pre></div>
<a name="r-am-obtain-permission"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Client Asks Authorization Server for Requester Permission Token and Permission</h3>

<p>A client making an access attempt accompanied by no RPT or by an invalid RPT will receive a 401 response back from the resource server, along with the authorization server's location from which it can learn the RPT endpoint. In this case, the client must obtain a valid RPT from the authorization server's RPT endpoint provided in the response (see <a class='info' href='#authz-permission-token'>Section&nbsp;3.4.2<span> (</span><span class='info'>Client Obtains Requester Permission Token</span><span>)</span></a>).
</p>
<p>A client making an access attempt with a valid RPT that has insufficient authorization data associated with it will receive a 403 response back from the resource server, along with a permission ticket and the authorization server's location from which it can learn the permission request endpoint. In this case, the client uses the permission ticket to ask for the necessary authorization data to be associated with its RPT. This process necessarily involves the requesting party because the authorization is sought on this party's behalf.
</p>
<p>The client takes action in the following ways (assuming that it has discovered the authorization server's configuration data and endpoints as required):</p>
<ul class="text">
<li>The client and authorization server establish mutual trust through the issuance of client credentials to the client. It is OPTIONAL for the client credentials to be provided dynamically through <a class='info' href='#DynClientReg'>[DynClientReg]<span> (</span><span class='info'>Richer, J., &ldquo;OAuth Dynamic Client Registration Protocol,&rdquo; November&nbsp;2012.</span><span>)</span></a>); alternatively, they MAY use a static process.
</li>
<li>The requesting party, client, and authorization server establish three-way trust through the issuance of an AAT. See <a class='info' href='#authz-api-token'>Section&nbsp;3.4.1<span> (</span><span class='info'>Client Obtains Authorization API Token</span><span>)</span></a> for additional details.
</li>
<li>The client obtains an RPT. See <a class='info' href='#authz-permission-token'>Section&nbsp;3.4.2<span> (</span><span class='info'>Client Obtains Requester Permission Token</span><span>)</span></a> for additional details.
</li>
</ul>

<a name="authz-api-token"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.1"></a><h3>3.4.1.&nbsp;
Client Obtains Authorization API Token</h3>

<p>In this step, the client acquires an AAT from the authorization server on the requesting party's behalf. The token represents the approval of this requesting party for this client to engage with this authorization server to supply claims, ask for authorization, and perform any other tasks needed for obtaining authorization for access to resources at all resource servers that use this authorization server. It is OPTIONAL for the requesting party to introduce the client to the authorization server dynamically through the process defined in <a class='info' href='#OAuth-resource-reg'>[OAuth&#8209;resource&#8209;reg]<span> (</span><span class='info'>Hardjono, T., &ldquo;OAuth 2.0 Resource Set Registration,&rdquo; December&nbsp;2012.</span><span>)</span></a>); alternatively, they MAY use a static process that does not directly involve the requesting party.
</p>
<p>The client MUST use OAuth 2.0 <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; September&nbsp;2011.</span><span>)</span></a> to obtain the AAT. Here the client requests the "http://docs.kantarainitiative.org/uma/scopes/authz.json" scope. Once the client has obtained its AAT, it presents it to the authorization server at the permission request endpoint.
</p>
<p>(NOTE: The "http://docs.kantarainitiative.org/uma/scopes/authz.json" scope keyword is a URI that resolves to a JSON-encoded scope description, in the fashion of UMA scope types. This scope description is non-normative.)
</p>
<p>The authorization server MAY support the use of any OAuth grant type for AAT issuance, but MUST support the authorization_code grant type, and SHOULD support the SAML bearer token grant type <a class='info' href='#OAuth-SAML'>[OAuth&#8209;SAML]<span> (</span><span class='info'>Campbell, B., &ldquo;SAML 2.0 Bearer Assertion Grant Type Profile for OAuth 2.0,&rdquo; August&nbsp;2011.</span><span>)</span></a> (urn:ietf:params:oauth:grant-type:saml2-bearer) if it anticipates working with clients that are operating in environments where the use of SAML is prevalent. The authorization server MUST indicate all grant types it supports for AAT issuance in its configuration data.
</p>
<p>By virtue of being able to identify this client/requesting party pair uniquely across all resource servers whose resources it protects, the authorization server is able to manage the process of authorization and claims-gathering efficiently. These management processes are outside the scope of this specification.
</p>
<a name="authz-permission-token"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.2"></a><h3>3.4.2.&nbsp;
Client Obtains Requester Permission Token</h3>

<p>In this step, if the client needs an RPT that applies to this requesting party for this resource server and this authorization server, it obtains an RPT. On first issuance the RPT is associated with no authorization data and thus does not convey any authorizations for access.
</p>
<p>The clieint performs a POST on the RPT endpoint. It MUST provide its own AAT in the header.
</p>
<p>Example of a request message containing an AAT:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>POST /rpt HTTP/1.1
Host: am.example.com
Authorization: Bearer jwfLG53^sad$#f
...
</pre></div>
<p>The authorization server responds with an HTTP 201 (Created) status code and provides a new RPT.
</p>
<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 201 Created
Content-Type: application/uma-rpt+json

{
  "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv"
}
</pre></div>
<p>If the content-type of the request is not recognized by the authorization server, the latter MUST produce an HTTP error.
</p>
<p>The client might need an RPT if it has never before requested an RPT for this combination of requesting party, resource server, and authorization server, or if it has lost control of a previously issued RPT and needs a refreshed one. If the AAT provided in the header is the same as one provided for a previously issued RPT by this authorization server, the authorization server invalidates the old RPT and issues a new one.
</p>
<p>If the request fails due to missing or invalid parameters, or is otherwise malformed, the authorization server SHOULD inform the client of the error by sending an HTTP error response.
</p>
<p>If the request fails due to an invalid, missing, or expired AAT or requires higher privileges at this endpoint than provided by the AAT, the authorization server responds with an OAuth error (see <a class='info' href='#oauth-error-response'>Section&nbsp;4.1<span> (</span><span class='info'>OAuth Error Responses</span><span>)</span></a>).
</p>
<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="example",
  error="invalid_token",
  error_description="The access token expired"
</pre></div>
<a name="r-am-authz-scope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.3"></a><h3>3.4.3.&nbsp;
Client Asks for Authorization</h3>

<p>Once in possession of an AAT for this authorization server, an RPT that applies to this requesting party for this resource server and this authorization server, and a permission ticket, the client asks the authorization server to give it suitable authorization data for the sought-for access. The client performs a POST on the permission request endpoint, supplying the items below. The client MUST provide its own AAT in the header. </p>
<ul class="text">
<li>The permission ticket it received from the resource server
</li>
<li>Its RPT for this resource server
</li>
<li>Its own AAT in the header
</li>
</ul>

<p>Example of a request message containing a permission ticket and RPT:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>POST /token_status HTTP/1.1
Host: am.example.com
Authorization: Bearer jwfLG53^sad$#f
...

{
 "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
 "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre></div>
<p>In this interaction, the client uses the authorization server's permission request endpoint. The authorization server uses the ticket to look up the details of the previously registered permission, maps the requested permission to operative user policies, undergoes any authorization flows required (see <a class='info' href='#authz-flows'>Section&nbsp;3.5<span> (</span><span class='info'>Claims-Gathering Flows</span><span>)</span></a>), and ultimately responds to the request positively or negatively.
</p>
<p>If the request fails due to an invalid, missing, or expired AAT (or RPT) or requires higher privileges at this endpoint than provided by the AAT, the authorization server responds with an OAuth error (see <a class='info' href='#oauth-error-response'>Section&nbsp;4.1<span> (</span><span class='info'>OAuth Error Responses</span><span>)</span></a>).
</p>
<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="example",
  error="invalid_token",
  error_description="The access token expired"
</pre></div>
<p>If the authorization server does not add the requested authorization data, it responds using the appropriate HTTP status code (typically 400 or 403), and includes one of the following error codes in the response (see <a class='info' href='#uma-error-response'>Section&nbsp;4.2<span> (</span><span class='info'>UMA Error Responses</span><span>)</span></a>): </p>
<blockquote class="text"><dl>
<dt>invalid_requester_ticket</dt>
<dd>The provided ticket was not found at the authorization server. The authorization server SHOULD respond with the HTTP 400 (Bad Request) status code.
</dd>
<dt>expired_requester_ticket</dt>
<dd>The provided ticket has expired. The authorization server SHOULD respond with the HTTP 400 (Bad Request) status code.
</dd>
<dt>not_authorized_permission</dt>
<dd>The client is definitively not authorized for this authorization according to user policy. The authorization server SHOULD respond with the HTTP 403 (Forbidden) status code.
</dd>
<dt>need_claims</dt>
<dd>The authorization server is unable to determine whether the client is authorized for this permission without gathering claims from the requesting party. The authorization server SHOULD respond with the HTTP 403 (Forbidden) status code. The client is therefore not authorized, but has the opportunity to engage its operator -- the requesting party -- in a claims-gathering flow with the authorization server (see <a class='info' href='#authz-flows'>Section&nbsp;3.5<span> (</span><span class='info'>Claims-Gathering Flows</span><span>)</span></a>) to potentially become authorized.
</dd>
</dl></blockquote>

<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 400 Bad Request
Content-Type: application/uma-status+json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "expired_requester_ticket"
}
</pre></div>
<a name="authz-flows"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Claims-Gathering Flows</h3>

<p>The authorization server MUST base the addition of authorization data to RPTs on user policies. The nature of these policies is outside the scope of UMA, but generally speaking, they can be thought of as either independent of requesting-party features (for example, time of day) or dependent on requesting-party features (for example, whether they are over 18). This latter case requires the requesting party to transmit identity claims to the AM in some fashion.
</p>
<p>The process for requesting and providing claims is extensible and may have a variety of dependencies on the type of requesting party (for example, natural person or legal person) and the type of client (for example, browser, native app, or autonomously running web service). UMA provides a framework for handling end-user-driven clients and an optional solution for gathering standardized claims from such an end-user, and allows for extensions to support other solutions for this use case and other use cases. The authorization server SHOULD document its claims-handling ability in its configuration data through the claim_profiles_supported property (see <a class='info' href='#am-endpoints'>Section&nbsp;1.5<span> (</span><span class='info'>Authorization Server Configuration Data</span><span>)</span></a>). For the business-level and legal implications of different technical authorization flows, see <a class='info' href='#UMA-obligations'>[UMA&#8209;obligations]<span> (</span><span class='info'>Maler, E., &ldquo;Binding Obligations on UMA Participants,&rdquo; April&nbsp;2012.</span><span>)</span></a>.
</p>
<a name="trusted-claims-human-driven"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5.1"></a><h3>3.5.1.&nbsp;
Claims-Gathering Flow for Clients Operated by End-Users</h3>

<p>A client, whether web-based or native, is operated by an end-user in one of two typical situations:</p>
<ul class="text">
<li>The requesting party is a natural person (for example, a friend of the resource owner); the requesting party may even be the resource owner herself.
</li>
<li>The requesting party is a legal person such as a corporation, and the end-user operating the client is acting as an agent of that legal person (for example, a customer support specialist representing a credit card company).
</li>
</ul>

<p>For convenience, this specification refers to the end-user as a "requesting end-user" to cover both cases, which differ only at the level of business agreements (and potentially law), rather than technology. The authorization server has a variety of options at this point for satisfying the resource owner's policy; this specification does not dictate a single answer. For example, the authorization server could require the requesting end-user to register for and/or log in to a local authorization server account, or to fill in a questionnaire, or to complete a purchase. It could even require several of these operations, where the order is treated as significant. A variety of claim profiling can be defined to achieve these effects.
</p>
<p>An end-user-driven client MUST redirect the requesting end-user to the authorization server to complete the process of authorization. The redirection MUST include a URI query parameter with the name "ticket" whose value conveys the permission ticket for which the need_claims error was received; for example, "ticket=016f84e8-f9b9-11e0-bd6f-0021cc6004de". Each claim profile MUST provide the following capabilities:</p>
<blockquote class="text"><dl>
<dt>redirect URI</dt>
<dd>A means by which the client MUST supply the URI to which the authorization server MUST redirect the requesting end-user at the end of the claims-gathering process.
</dd>
<dt>callback URI</dt>
<dd>A means by which the client OPTIONALLY supplies a callback URI for the authorization server to use.
</dd>
<dt>state</dt>
<dd>A means by which the client SHOULD supply an opaque value used to maintain state between the request and the callback; this serves as a protection against XSRF attacks.
</dd>
</dl></blockquote>

<p>An authorization server MAY support any number of claim profiles. One potential such profile is defined in this specification: the "openid" claim profile, which leverages OpenID Connect for gathering generally useful identity claims (see <a class='info' href='#trusted-claims'>Section&nbsp;3.5.1.1<span> (</span><span class='info'>UMA OpenID Connect Claim Profile</span><span>)</span></a>).
</p>
<a name="trusted-claims"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5.1.1"></a><h3>3.5.1.1.&nbsp;
UMA OpenID Connect Claim Profile</h3>

<p>This section defines the UMA OpenID Connect claim profile. Following is a summary:</p>
<ul class="text">
<li>Identifying URI: http://docs.kantarainitiative.org/uma/profiles/uma-claim-openid-1.0
</li>
<li>Profile author and contact information: Thomas Hardjono (hardjono@mit.edu)
</li>
<li>Updates or obsoletes: None; this profile is new.
</li>
<li>Authorization server configuration data: To indicate support, supply the keyword "openid" in the "claim_profiles_supported" property value.
</li>
<li>Syntax and semantics of claim data: As defined below. The claim data format leverages the OpenID Connect protocol and the reserved claims defined in that specification.
</li>
<li>Claims gathering method: As defined below.
</li>
<li>Error states: None additional.
</li>
<li>Security and privacy considerations: None additional.
</li>
<li>Binding obligations: Binding obligations that apply to the use of this claim profile are documented in <a class='info' href='#UMA-obligations'>[UMA&#8209;obligations]<span> (</span><span class='info'>Maler, E., &ldquo;Binding Obligations on UMA Participants,&rdquo; April&nbsp;2012.</span><span>)</span></a>.
</li>
</ul>

<p>If an authorization server supports the OpenID Connect claim profile, it MUST supply the "openid" value for one of its "claim_profiles_supported" values in its configuration data.
</p>
<p>To conform to this option, the authorization server MUST do the following:</p>
<ul class="text">
<li>Serve as a conforming OpenID Relying Party and Claims Client according to <a class='info' href='#OCStandard'>[OCStandard]<span> (</span><span class='info'>Sakimura, N., &ldquo;OpenID Connect Standard 1.0,&rdquo; September&nbsp;2011.</span><span>)</span></a>
</li>
<li>Be able to utilize at least all of the reserved claims defined in <a class='info' href='#OCMessages'>[OCMessages]<span> (</span><span class='info'>Sakimura, N., &ldquo;OpenID Connect Messages 1.0,&rdquo; September&nbsp;2011.</span><span>)</span></a> in assessing policy and granting permissions
</li>
<li>Use the OpenID Connect "redirect_uri" and "state" request parameters as appropriate
</li>
</ul>

<p>The authorization server can then use any conforming OpenID Connect mechanisms and typical user interfaces for engaging with the UserInfo endpoints of OpenID Providers and Claims Providers, potentially allowing for the delivery of "trusted claims" (such as a verified email address or a date or birth) on which authorization policy may depend.
</p>
<a name="errors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Error Messages</h3>

<p>Ultimately the resource server is responsible for either granting the access the client attempted, or returning an error response to the client with a reason for the failure. <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; September&nbsp;2011.</span><span>)</span></a> defines several error responses for a resource server to return. UMA makes use of these error responses, but requires the resource server to "outsource" the determination of some error conditions to the authorization server. UMA defines its own additional error responses that the authorization server may give to the resource server and client as they interact with it, and that the resource server may give to the client.
</p>
<a name="oauth-error-response"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
OAuth Error Responses</h3>

<p>When a resource server or client attempts to access one of the authorization server endpoints <a class='info' href='#am-endpoints'>Section&nbsp;1.5<span> (</span><span class='info'>Authorization Server Configuration Data</span><span>)</span></a> or a client attempts to access a protected resource at the resource server, it has to make an authenticated request by including an OAuth access token in the HTTP request as described in <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; September&nbsp;2011.</span><span>)</span></a> Section 7.
</p>
<p>If the request failed authentication, the authorization server or the resource server responds with an OAuth error message as described throughout <a class='info' href='#protecting-a-resource'>Section&nbsp;2<span> (</span><span class='info'>Protecting a Resource</span><span>)</span></a> and <a class='info' href='#getting-authz-accessing-resource'>Section&nbsp;3<span> (</span><span class='info'>Getting Authorization and Accessing a Resource</span><span>)</span></a>.
</p>
<a name="uma-error-response"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
UMA Error Responses</h3>

<p>When a resource server or client attempts to access one of the authorization server endpoints <a class='info' href='#am-endpoints'>Section&nbsp;1.5<span> (</span><span class='info'>Authorization Server Configuration Data</span><span>)</span></a> or a client attempts to access a protected resource at the resource server, if the request is successfully authenticated by OAuth means, but is invalid for another reason, the authorization server or resource server responds with an UMA error response by adding the following properties to the entity body of the HTTP response: </p>
<blockquote class="text"><dl>
<dt>error</dt>
<dd>REQUIRED. A single error code. Value for this property is defined in the specific authorization server endpoint description.
</dd>
<dt>error_description</dt>
<dd>OPTIONAL. Human-readable text providing additional information, used to assist in the understanding and resolution of the error occurred.
</dd>
<dt>error_uri</dt>
<dd>OPTIONAL. A URI identifying a human-readable web page with information about the error, used to provide the end-user with additional information about the error.
</dd>
</dl></blockquote>

<p>Common error codes: </p>
<blockquote class="text"><dl>
<dt>invalid_request</dt>
<dd>The request is missing a required parameter or is otherwise malformed. The authorization server MUST respond with the HTTP 400 (Bad Request) status code.
</dd>
</dl></blockquote>

<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 400 Bad Request
Content-Type: application/uma-status+json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "invalid_request",
  "error_description": "There is already a resource with this identifier.",
  "error_uri": "http://am.example.com/errors/resource_exists"
}
</pre></div>
<a name="profiles"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Specification of Additional Profiles</h3>

<p>This specification defines a protocol that has optional features in it. For interoperability and deployment purposes to serve particular use cases, third parties may want to define profiles of the UMA core protocol that restrict these options.
</p>
<p>Further, this specification has two modular and extensible elements of its design that are specified in terms of specific kinds of profiles:</p>
<ul class="text">
<li>RPT token formats and associated sub-protocol flows: These are specified in terms of UMA token profiles.
</li>
<li>Claims-gathering sub-protocol flows and specific claim types: These are specified in terms of UMA claim profiles.
</li>
</ul>

<p>Likewise, third parties may want to define additional token and claim profiles to achieve interoperability and deployment success for particular use cases. It is not practical for this specification to standardize all of these additional profiles. However, to serve overall interoperability goals, the following sections provide guidelines for third parties that wish to specify UMA profiles.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Specifying UMA Profiles</h3>

<p>It is STRONGLY RECOMMENDED that UMA profiles document the following information:
</p>
<p></p>
<ol class="text">
<li>Specify a URI that uniquely identifies the profile.
</li>
<li>Identify the responsible author and provide postal or electronic contact information.
</li>
<li>Supply references to previously defined profiles that the profile updates or obsoletes.
</li>
<li>Specify relevant authorization server configuration data defined and/or utilized by the profile.
</li>
<li>Specify the set of interactions between endpoint entites involved in the profile, calling out any restrictions on ordinary UMA-conformant operations and any extension properties used in message formats.
</li>
<li>Identify the legally responsible parties involved in each interaction and any new obligations imposed, in the fashion of <a class='info' href='#UMA-obligations'>[UMA&#8209;obligations]<span> (</span><span class='info'>Maler, E., &ldquo;Binding Obligations on UMA Participants,&rdquo; April&nbsp;2012.</span><span>)</span></a>.
</li>
<li>Define any additional or changed error states.
</li>
<li>Supply any additional security and privacy considerations, including analysis of threats and description of countermeasures.
</li>
</ol>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Specifying UMA Token Profiles</h3>

<p>It is STRONGLY RECOMMENDED that UMA token profiles document the following information:
</p>
<p></p>
<ol class="text">
<li>Specify a URI that uniquely identifies the token profile.
</li>
<li>Identify the responsible author and provide postal or electronic contact information.
</li>
<li>Supply references to previously defined token profiles that the token profile updates or obsoletes.
</li>
<li>Specify the keyword to be used in HTTP Authorization headers with tokens conforming to this profile.
</li>
<li>Specify relevant authorization server configuration data defined and/or utilized by the token profile. At a minimum, specify the keyword for an authorization server to supply in the value of the "uma_token_profiles_supported" property to advertise its support for this token profile.
</li>
<li>Specify the syntax and semantics of the data that the authorization server associates with the token.
</li>
<li>Specify how the token data is associated with, contained within, and/or retrieved by means of, the on-the-wire token string.
</li>
<li>Specify processing rules for token data.
</li>
<li>Identify any restrictions on grant types to be used with the token profile.
</li>
<li>Define any additional or changed error states.
</li>
<li>Supply any additional security and privacy considerations.
</li>
<li>Specify any obligations specific to the token profile, in the fashion of <a class='info' href='#UMA-obligations'>[UMA&#8209;obligations]<span> (</span><span class='info'>Maler, E., &ldquo;Binding Obligations on UMA Participants,&rdquo; April&nbsp;2012.</span><span>)</span></a>.
</li>
</ol>

<p>See <a class='info' href='#uma-bearer-token-profile'>Section&nbsp;3.3.1<span> (</span><span class='info'>UMA Bearer Token Profile</span><span>)</span></a> for an example.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Specifying UMA Claim Profiles</h3>

<p>It is STRONGLY RECOMMENDED that UMA claim profiles document the following information:</p>
<ol class="text">
<li>Specify a URI that uniquely identifies the claim profile.
</li>
<li>Identify the responsible author and provide postal or electronic contact information.
</li>
<li>Supply references to previously defined claim profiles that the claim profile updates or obsoletes.
</li>
<li>Specify relevant authorization server configuration data defined and/or utilized by the claim profile. At a minimum, specify the keyword for an authorization server to supply in the value of the "claim_profiles_supported" property to advertise its support for this claim profile.
</li>
<li>Specify the syntax and semantics of claim data and requests for claim data.
</li>
<li>Specify how an authorization server gathers the claims.
</li>
<li>Define any additional or changed error states.
</li>
<li>Supply any additional security and privacy considerations.
</li>
<li>Specify any obligations specific to the claim profile, in the fashion of <a class='info' href='#UMA-obligations'>[UMA&#8209;obligations]<span> (</span><span class='info'>Maler, E., &ldquo;Binding Obligations on UMA Participants,&rdquo; April&nbsp;2012.</span><span>)</span></a>.
</li>
</ol>

<p>See <a class='info' href='#trusted-claims'>Section&nbsp;3.5.1.1<span> (</span><span class='info'>UMA OpenID Connect Claim Profile</span><span>)</span></a> for an example.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>This specification relies mainly on OAuth security mechanisms for protecting the host registration endpoint at the authorization server so that only a properly authorized host can access it on behalf of the intended user. For example, the host needs to use a valid protection API token (PAT) issued through a user authorization process at the endpoint, and the interaction SHOULD take place over TLS. It is expected that the host will protect its client secret (if it was issued one) and its PAT, particularly if used in "bearer token" fashion.
</p>
<p>In addition, this specification dictates a binding between the PAT and the host-specific registration area on the authorization server to prevent a host from interacting with a registration area not its own.
</p>
<p>This specification defines a number of JSON-based data formats. As a subset of the JavaScript scripting language, JSON data SHOULD be consumed through a process that does not dynamically execute it as code, to avoid malicious code execution. One way to achieve this is to use a JavaScript interpreter rather than the built-in JavaScript eval() function.
</p>
<p>For information about the technical, operational, and legal elements of trust establishment between UMA entities and parties, which affects security considerations, see <a class='info' href='#UMA-obligations'>[UMA&#8209;obligations]<span> (</span><span class='info'>Maler, E., &ldquo;Binding Obligations on UMA Participants,&rdquo; April&nbsp;2012.</span><span>)</span></a>.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Privacy Considerations</h3>

<p>The authorization server comes to be in possession of resource set information (such as names and icons) that may reveal information about the user, which the authorization server's trust relationship with the host is assumed to accommodate. However, the client is a less-trusted party (in fact, entirely untrustworthy until it acquires permissions for an RPT in UMA protocol phase 2. This specification recommends obscuring resource set identifiers in order to avoid leaking personally identifiable information to clients through the "scope" mechanism.
</p>
<p>For information about the technical, operational, and legal elements of trust establishment between UMA entities and parties, which affects privacy considerations, see <a class='info' href='#UMA-obligations'>[UMA&#8209;obligations]<span> (</span><span class='info'>Maler, E., &ldquo;Binding Obligations on UMA Participants,&rdquo; April&nbsp;2012.</span><span>)</span></a>.
</p>
<a name="conformance"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Conformance</h3>

<p>This section outlines conformance requirements for various entities implementing UMA endpoints.
</p>
<p>This specification has dependencies on other specifications, as follows:</p>
<ul class="text">
<li>OAuth 2.0: AMs, hosts, and requesters MUST support <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; September&nbsp;2011.</span><span>)</span></a> features named in this specification for conformance. For example, AMs MUST support the authorization_code grant type.
</li>
<li>hostmeta: AMs, hosts, and requesters MUST support the <a class='info' href='#RFC6415'>[RFC6415]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;Web Host Metadata,&rdquo; October&nbsp;2011.</span><span>)</span></a> features named in this specification.
</li>
<li>OpenID Connect: AMs MAY support <a class='info' href='#DynClientReg'>[DynClientReg]<span> (</span><span class='info'>Richer, J., &ldquo;OAuth Dynamic Client Registration Protocol,&rdquo; November&nbsp;2012.</span><span>)</span></a>, and MAY choose to conform to the "openid" claim format option, corresponding to the OpenID Connect RP role defined in <a class='info' href='#OCStandard'>[OCStandard]<span> (</span><span class='info'>Sakimura, N., &ldquo;OpenID Connect Standard 1.0,&rdquo; September&nbsp;2011.</span><span>)</span></a> and support for OpenID Connect reserved claims defined in <a class='info' href='#OCMessages'>[OCMessages]<span> (</span><span class='info'>Sakimura, N., &ldquo;OpenID Connect Messages 1.0,&rdquo; September&nbsp;2011.</span><span>)</span></a>.
</li>
</ul>

<p>The AM's configuration data provides a machine-readable method for an AM to indicate certain of the conformance options it has chosen. Several of the data properties allow for extensibility. Where this specification does not already require optional features to be documented, it is RECOMMENDED that AM developers and deployers document any profiled or extended features explicitly and use configuration data to indicate their usage. See <a class='info' href='#am-endpoints'>Section&nbsp;1.5<span> (</span><span class='info'>Authorization Server Configuration Data</span><span>)</span></a> for information about providing and extending AM configuration data.
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>This document makes no request of IANA.
</p>
<a name="Acknowledgments"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgments</h3>

<p>The current editor of this specification is Thomas Hardjono of MIT. The following people are co-authors:</p>
<ul class="text">
<li>Paul C. Bryan, ForgeRock US, Inc. (former editor)
</li>
<li>Domenico Catalano, Oracle Corp.
</li>
<li>George Fletcher, AOL
</li>
<li>Maciej Machulak, Newcastle University
</li>
<li>Eve Maler, XMLgrrl.com
</li>
<li>Lukasz Moren, Newcastle University
</li>
<li>Christian Scholz, COMlounge GmbH (former editor)
</li>
<li>Jacek Szpot, Newcastle University
</li>
</ul>

<p>Additional contributors to this specification include the Kantara UMA Work Group participants, a list of whom can be found at <a class='info' href='#UMAnitarians'>[UMAnitarians]<span> (</span><span class='info'>Maler, E., &ldquo;UMA Participant Roster,&rdquo; 2012.</span><span>)</span></a>.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Issues</h3>

<p>All issues are now captured at the project's GitHub site (<a href='https://github.com/xmlgrrl/UMA-Specifications/issues'>https://github.com/xmlgrrl/UMA-Specifications/issues</a>).
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="DynClientReg">[DynClientReg]</a></td>
<td class="author-text">Richer, J., &ldquo;<a href="https://datatracker.ietf.org/doc/draft-ietf-oauth-dyn-reg/">OAuth Dynamic Client Registration Protocol</a>,&rdquo; November&nbsp;2012.</td></tr>
<tr><td class="author-text" valign="top"><a name="OAuth-SAML">[OAuth-SAML]</a></td>
<td class="author-text">Campbell, B., &ldquo;<a href="http://tools.ietf.org/html/draft-ietf-oauth-saml2-bearer">SAML 2.0 Bearer Assertion Grant Type Profile for OAuth 2.0</a>,&rdquo; August&nbsp;2011.</td></tr>
<tr><td class="author-text" valign="top"><a name="OAuth-bearer">[OAuth-bearer]</a></td>
<td class="author-text">&ldquo;<a href="http://tools.ietf.org/html/rfc6750">The OAuth 2.0 Authorization Framework: Bearer Token Usage</a>,&rdquo; October&nbsp;2012.</td></tr>
<tr><td class="author-text" valign="top"><a name="OAuth-introspection">[OAuth-introspection]</a></td>
<td class="author-text">Richer, J., &ldquo;<a href="http://tools.ietf.org/html/draft-richer-oauth-introspection-00">OAuth 2.0 Token Introspection</a>,&rdquo; November&nbsp;2012.</td></tr>
<tr><td class="author-text" valign="top"><a name="OAuth-linktypes">[OAuth-linktypes]</a></td>
<td class="author-text">Mills, W., &ldquo;<a href="https://datatracker.ietf.org/doc/draft-wmills-oauth-lrdd/?include_text=1">Link Type Registrations for OAuth2</a>,&rdquo; November&nbsp;2012.</td></tr>
<tr><td class="author-text" valign="top"><a name="OAuth-resource-reg">[OAuth-resource-reg]</a></td>
<td class="author-text">Hardjono, T., &ldquo;OAuth 2.0 Resource Set Registration,&rdquo; December&nbsp;2012.</td></tr>
<tr><td class="author-text" valign="top"><a name="OAuth2">[OAuth2]</a></td>
<td class="author-text">Hammer-Lahav, E., &ldquo;<a href="http://tools.ietf.org/html/draft-ietf-oauth-v2">The OAuth 2.0 Protocol</a>,&rdquo; September&nbsp;2011.</td></tr>
<tr><td class="author-text" valign="top"><a name="OCMessages">[OCMessages]</a></td>
<td class="author-text">Sakimura, N., &ldquo;<a href="http://openid.net/specs/openid-connect-messages-1_0.html">OpenID Connect Messages 1.0</a>,&rdquo; September&nbsp;2011.</td></tr>
<tr><td class="author-text" valign="top"><a name="OCStandard">[OCStandard]</a></td>
<td class="author-text">Sakimura, N., &ldquo;<a href="http://openid.net/specs/openid-connect-standard-1_0.html">OpenID Connect Standard 1.0</a>,&rdquo; September&nbsp;2011.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4627">[RFC4627]</a></td>
<td class="author-text">Crockford, D., &ldquo;<a href="http://tools.ietf.org/html/rfc4627">The application/json Media Type for JavaScript Object Notation (JSON)</a>,&rdquo; RFC&nbsp;4627, July&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4627.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC6415">[RFC6415]</a></td>
<td class="author-text">Hammer-Lahav, E., &ldquo;<a href="http://tools.ietf.org/html/rfc6415">Web Host Metadata</a>,&rdquo; October&nbsp;2011.</td></tr>
<tr><td class="author-text" valign="top"><a name="UMA-obligations">[UMA-obligations]</a></td>
<td class="author-text">Maler, E., &ldquo;<a href="http://kantarainitiative.org/confluence/display/uma/UMA+Trust+Model">Binding Obligations on UMA Participants</a>,&rdquo; April&nbsp;2012.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="UMA-casestudies">[UMA-casestudies]</a></td>
<td class="author-text">Maler, E., &ldquo;<a href="http://kantarainitiative.org/confluence/display/uma/Case+Studies">UMA Case Studies</a>,&rdquo; December&nbsp;2012.</td></tr>
<tr><td class="author-text" valign="top"><a name="UMA-usecases">[UMA-usecases]</a></td>
<td class="author-text">Maler, E., &ldquo;<a href="http://kantarainitiative.org/confluence/display/uma/UMA+Scenarios+and+Use+Cases">UMA Scenarios and Use Cases</a>,&rdquo; October&nbsp;2010.</td></tr>
<tr><td class="author-text" valign="top"><a name="UMAnitarians">[UMAnitarians]</a></td>
<td class="author-text">Maler, E., &ldquo;<a href="http://kantarainitiative.org/confluence/display/uma/Participant+Roster">UMA Participant Roster</a>,&rdquo; 2012.</td></tr>
</table>

<a name="History"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Document History</h3>

<p>NOTE: To be removed by RFC editor before publication as an RFC.
</p>
<p>From I-D rev 03 to rev 04, the following major changes have been made:</p>
<ul class="text">
<li>The requirement to support the client_credentials flow has been removed.
</li>
<li>The requester access token has been split into two tokens, and all of the tokens have been renamed. The host access token is now the PAT. The requester access token used at the AM's API is now the AAT, and consists of vanilla OAuth. The requester access token used at the host is now the RPT.
</li>
<li>The token and user authorization endpoints for the different APIs at the AM have been joined together, and are now distinguished through the "http://docs.kantarainitiative.org/uma/scopes/prot.json" scope (for the protection API) and the "http://docs.kantarainitiative.org/uma/scopes/authz.json" scope (for the authorization API).
</li>
<li>The token status description format and JSON media type, and the RPT/permission delivery response, have been updated to reflect the RPT naming.
</li>
<li>The configuration data format has changed to reflect the changes above.
</li>
<li>The Phase 2/3 flow has changed and been simplified to match the requirements of the new AAT and RPT.
</li>
<li>Token types are now called token profiles, and this is reflected in the configuration parameter names. Claim types are now called claim profiles, and this is also reflected in the configuration parameter name.
</li>
<li>The requester now asks for permission in a back-channel interaction, and the AM now produces a need_claims error that instructs the requester to use a claims-gathering flow (renamed from "authorization flow").
</li>
<li>Named subsections for token and claim profiles have been added so that they show up in the TOC.
</li>
</ul>

<p>From I-D rev 04 to rev 05, the following major changes have been made:</p>
<ul class="text">
<li>The RPT-getting flow and the permission-requesting flow have been separated back out, with two distinct endpoints, RPT and permission request.
</li>
<li>The configuration data format has changed to reflect the changes above.
</li>
</ul>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Thomas Hardjono (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">MIT</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hardjono@mit.edu">hardjono@mit.edu</a></td></tr>
</table>
</body></html>
